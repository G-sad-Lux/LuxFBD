<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lux | Sitio Sencillo y Responsivo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f8fafc;
            --card: #ffffff;
            --primary: #4c6ef5;
            --primary-dark: #364fc7;
            --text: #0f172a;
            --muted: #475569;
            --radius: 18px;
            --shadow: 0 12px 35px rgba(79, 70, 229, 0.08);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Space Grotesk', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        img {
            max-width: 100%;
            display: block;
        }

        header {
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 15;
            border-bottom: 1px solid rgba(15, 23, 42, 0.08);
            box-shadow: 0 12px 25px rgba(15, 23, 42, 0.04);
        }

        .app-header {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.85rem 1.5rem;
            gap: 1rem;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .brand img {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: rgba(76, 110, 245, 0.1);
            padding: 0.3rem;
        }

        .brand-name {
            font-weight: 600;
            display: block;
        }

        .brand small {
            color: var(--muted);
            font-size: 0.8rem;
        }

        .nav-links {
            list-style: none;
            display: flex;
            gap: 1.2rem;
            margin: 0;
            padding: 0;
        }

        .nav-link {
            text-decoration: none;
            color: var(--muted);
            font-weight: 500;
            position: relative;
            padding: 0.35rem 0.2rem;
        }

        .nav-link.active,
        .nav-link:hover {
            color: var(--text);
        }

        .nav-link.active::after {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            bottom: -0.35rem;
            height: 3px;
            border-radius: 999px;
            background: var(--primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .icon-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid rgba(15, 23, 42, 0.12);
            background: #fff;
            display: grid;
            place-items: center;
            cursor: pointer;
            color: var(--muted);
        }

        .profile-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0.35rem 0.8rem;
            border-radius: 999px;
            border: 1px solid rgba(15, 23, 42, 0.12);
            font-weight: 600;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem 4rem;
            display: flex;
            flex-direction: column;
            gap: 3rem;
        }

        .hero {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            align-items: center;
        }

        .hero-card {
            background: var(--card);
            border-radius: var(--radius);
            padding: clamp(1.5rem, 4vw, 2.5rem);
            box-shadow: var(--shadow);
        }

        .hero-card small {
            display: inline-flex;
            padding: 0.35rem 0.8rem;
            border-radius: 999px;
            border: 1px solid rgba(76, 110, 245, 0.25);
            color: var(--primary-dark);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
            font-size: 0.7rem;
        }

        .hero h1 {
            font-size: clamp(2rem, 6vw, 3.4rem);
            margin: 1rem 0 0.75rem;
            line-height: 1.15;
        }

        .hero p {
            color: var(--muted);
            margin-bottom: 1.5rem;
        }

        .hero-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .btn {
            border: none;
            border-radius: 999px;
            padding: 0.95rem 1.8rem;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: #fff;
            box-shadow: 0 12px 25px rgba(76, 110, 245, 0.3);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid rgba(15, 23, 42, 0.18);
            color: var(--text);
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
        }

        .feature {
            background: var(--card);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .feature h3 {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .feature p {
            color: var(--muted);
            font-size: 0.95rem;
        }

        .showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.25rem;
        }

        .showcase figure {
            margin: 0;
            border-radius: var(--radius);
            overflow: hidden;
            background: #0f172a;
            color: #fff;
            position: relative;
            min-height: 220px;
            display: flex;
            align-items: flex-end;
            padding: 1.25rem;
        }

        .showcase span {
            font-weight: 600;
        }

        .contact {
            background: var(--card);
            border-radius: var(--radius);
            padding: clamp(1.5rem, 5vw, 2.5rem);
            box-shadow: var(--shadow);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 2rem;
        }

        .login-page {
            background: linear-gradient(135deg, rgba(76, 110, 245, 0.08), rgba(54, 79, 199, 0.05));
            border-radius: var(--radius);
            padding: clamp(2rem, 6vw, 3rem);
            display: flex;
            justify-content: center;
        }

        .login-card {
            width: min(480px, 100%);
            background: #fff;
            border-radius: 26px;
            padding: clamp(1.75rem, 4vw, 2.5rem);
            box-shadow: 0 25px 55px rgba(15, 23, 42, 0.12);
            border: 1px solid rgba(76, 110, 245, 0.12);
        }

        .login-card img {
            width: 120px;
            margin: 0 auto 1rem;
            display: block;
        }

        .login-card h2 {
            text-align: center;
            margin-bottom: 0.25rem;
        }

        .login-subtitle {
            text-align: center;
            color: var(--muted);
            margin-bottom: 1.5rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .login-form label {
            font-weight: 600;
            color: var(--muted);
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .login-form input {
            border-radius: 10px;
        }

        .login-alert {
            border-radius: 12px;
            padding: 0.9rem 1rem;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .login-alert.error {
            background: rgba(244, 63, 94, 0.1);
            color: #b91c1c;
            border: 1px solid rgba(244, 63, 94, 0.3);
        }

        .login-alert.success {
            background: rgba(34, 197, 94, 0.12);
            color: #15803d;
            border: 1px solid rgba(34, 197, 94, 0.35);
        }

        .login-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .login-links {
            margin-top: 1.25rem;
            border-top: 1px solid rgba(15, 23, 42, 0.08);
            padding-top: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .login-links a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .login-guest {
            border-radius: 12px;
            padding: 0.85rem 1rem;
            background: rgba(15, 23, 42, 0.04);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .login-guest button {
            border-radius: 8px;
            padding: 0.5rem 1rem;
            border: none;
            background: var(--text);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
        }

        .student-dashboard {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            padding-top: 1rem;
        }

        .student-dashboard[hidden] {
            display: none;
        }

        .courses-layout {
            background: #fff;
            border-radius: 26px;
            padding: clamp(1.5rem, 4vw, 2.5rem);
            box-shadow: var(--shadow);
        }

        .courses-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .eyebrow {
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.75rem;
            color: var(--muted);
            margin: 0;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 0.75rem;
            width: min(520px, 100%);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            font-size: 0.85rem;
            color: var(--muted);
        }

        .filter-group select,
        .filter-group input {
            border-radius: 12px;
            border: 1px solid rgba(15, 23, 42, 0.18);
            padding: 0.65rem 0.85rem;
            font: inherit;
        }

        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.2rem;
        }

        .course-card {
            border-radius: 18px;
            padding: 1rem;
            color: #fff;
            min-height: 150px;
            position: relative;
            overflow: hidden;
        }

        .course-card::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(0, 0, 0, 0.25));
            mix-blend-mode: soft-light;
            pointer-events: none;
        }

        .course-card>* {
            position: relative;
            z-index: 1;
        }

        .course-body {
            margin-bottom: 2rem;
        }

        .course-title {
            font-weight: 600;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .course-format {
            font-size: 0.85rem;
            opacity: 0.85;
        }

        .course-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .course-progress {
            font-weight: 600;
        }

        .course-menu {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 34px;
            height: 34px;
            color: #fff;
            font-size: 1.1rem;
            cursor: pointer;
        }

        .courses-view {
            display: inline-flex;
            gap: 0.4rem;
            align-items: center;
        }

        .pill-button {
            border: 1px solid rgba(15, 23, 42, 0.2);
            background: transparent;
            color: var(--text);
            border-radius: 999px;
            padding: 0.35rem 0.9rem;
            font-weight: 600;
            cursor: pointer;
        }

        .pill-button.active {
            background: var(--text);
            color: #fff;
            border-color: var(--text);
        }

        .courses-footer {
            margin-top: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            color: var(--muted);
        }

        .courses-footer select {
            border-radius: 10px;
            border: 1px solid rgba(15, 23, 42, 0.18);
            padding: 0.4rem 0.8rem;
            font: inherit;
        }

        .hidden {
            display: none !important;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        input,
        textarea {
            border: 1px solid rgba(15, 23, 42, 0.15);
            border-radius: 12px;
            padding: 0.85rem 1rem;
            font: inherit;
            resize: vertical;
        }

        textarea {
            min-height: 140px;
        }

        footer {
            text-align: center;
            padding: 2rem 1rem 3rem;
            color: var(--muted);
            font-size: 0.9rem;
        }

        @media (max-width: 640px) {
            .app-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .nav-links {
                flex-wrap: wrap;
            }

            .hero-actions {
                flex-direction: column;
                width: 100%;
            }

            .btn {
                width: 100%;
                text-align: center;
            }

            .login-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .login-guest {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
        }

        /* Chatbot Widget */
        .chat-widget-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(76, 110, 245, 0.4);
            cursor: pointer;
            display: grid;
            place-items: center;
            font-size: 1.5rem;
            z-index: 1000;
            transition: transform 0.2s ease;
        }

        .chat-widget-btn:hover {
            transform: scale(1.05);
        }

        /* --- Support View Styles --- */
        .ticket-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
        }

        .ticket-table th,
        .ticket-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ticket-table th {
            background: rgba(0, 0, 0, 0.3);
            color: var(--gold);
            font-weight: 600;
        }

        .ticket-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-open {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
        }

        .status-closed {
            background: rgba(255, 255, 255, 0.1);
            color: #888;
        }

        /* Detail Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal.open {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: #1a1a1a;
            border: 1px solid var(--gold);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 16px;
            padding: 30px;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .detail-item label {
            color: #888;
            font-size: 0.9em;
            display: block;
            margin-bottom: 5px;
        }

        .detail-item span {
            font-size: 1.1em;
            color: white;
        }

        .timeline {
            border-left: 2px solid var(--gold-dim);
            padding-left: 20px;
            margin-top: 20px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -26px;
            top: 5px;
            width: 10px;
            height: 10px;
            background: var(--gold);
            border-radius: 50%;
        }

        .timeline-date {
            font-size: 0.8em;
            color: #888;
        }

        .timeline-content {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            margin-top: 5px;
        }

        .chat-widget-btn[hidden] {
            display: none !important;
        }

        .chat-window {
            position: fixed;
            bottom: 6rem;
            right: 2rem;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            overflow: hidden;
            transform-origin: bottom right;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            opacity: 0;
            transform: scale(0.9);
            pointer-events: none;
        }

        .chat-window.open {
            opacity: 1;
            transform: scale(1);
            pointer-events: all;
        }

        .chat-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            margin: 0;
            font-size: 1rem;
        }

        .chat-close {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .chat-back {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            margin-right: auto;
            /* Push others to right */
            display: none;
            /* Hidden by default */
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            background: #f8fafc;
        }

        .message {
            max-width: 80%;
            padding: 0.8rem 1rem;
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .message.bot {
            background: white;
            border: 1px solid #e2e8f0;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }

        .message.user {
            background: var(--primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        .chat-input-area {
            padding: 1rem;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 0.5rem;
        }

        .chat-input-area input {
            flex: 1;
            padding: 0.6rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .chat-send {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            width: 40px;
            cursor: pointer;
            display: grid;
            place-items: center;
        }

        .chat-attach-btn {
            background: transparent;
            color: var(--muted);
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            width: 40px;
            cursor: pointer;
            display: grid;
            place-items: center;
            font-size: 1.2rem;
        }

        .chat-attach-btn:hover {
            background: #f1f5f9;
            color: var(--primary);
        }

        .chat-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .chat-option-btn {
            background: white;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 0.4rem 0.8rem;
            border-radius: 16px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chat-option-btn:hover {
            background: var(--primary);
            color: white;
        }
    </style>
</head>

<body>
    <header>
        <div class="app-header">
            <div class="brand">
                <img src="assets/images/lux-logo.svg" alt="Logo Universidad Lux" />
                <div>
                    <span class="brand-name">Universidad Lux</span>
                    <small>Campus Digital</small>
                </div>
            </div>
            <nav aria-label="Navegaci√≥n principal">
                <ul class="nav-links">
                    <li><a href="#login" class="nav-link" data-route="login">Inicio</a></li>
                    <li><a href="#mis-cursos" class="nav-link" data-route="tablero">Tablero</a></li>
                    <li><a href="#mis-cursos" class="nav-link" data-route="mis-cursos">Mis cursos</a></li>
                    <li><a href="#soporte" class="nav-link" data-route="soporte-luxia">Soporte LuxIA</a></li>

                </ul>
            </nav>
            <div class="header-actions">
                <button class="icon-button" aria-label="Notificaciones">üîî</button>
                <button class="icon-button" aria-label="Mensajes">‚úâÔ∏è</button>
                <div class="profile-chip">
                    <span>AT</span>
                    <small>Perfil</small>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section id="login" class="login-page">
            <div class="login-card">
                <img src="assets/images/lux-logo.svg" alt="Logo Universidad Lux" />
                <h2>Ingreso a Campus Lux</h2>
                <p class="login-subtitle">Ingresa con tu correo institucional y contrase√±a.</p>
                <hr />
                <div id="login-alert" class="login-alert error" hidden>
                    Credenciales inv√°lidas. Intenta nuevamente.
                </div>
                <form id="login-form" class="login-form">
                    <label>
                        Correo Electr√≥nico
                        <input type="email" name="email" autocomplete="email" required placeholder="ejemplo@lux.edu">
                    </label>
                    <label>
                        Contrase√±a
                        <input type="password" name="password" autocomplete="current-password" required>
                    </label>
                    <div class="login-actions">
                        <button type="submit" class="btn btn-primary">Iniciar sesi√≥n</button>
                        <button type="button" class="btn btn-secondary">¬øOlvidaste tu contrase√±a?</button>
                    </div>
                </form>
                <div class="login-links">
                    <span>Algunos cursos permiten acceso invitado</span>
                    <div class="login-guest">
                        <div>
                            <strong>Visitante</strong>
                            <p style="margin: 0; color: var(--muted); font-size: 0.9rem;">Explora contenido limitado sin
                                credenciales.</p>
                        </div>
                        <button type="button">Entrar como invitado</button>
                    </div>
                    <a href="#">Aviso de cookies</a>
                </div>
            </div>
        </section>
        <div id="student-dashboard" class="student-dashboard" hidden>
            <section id="mis-cursos" class="courses-layout">
                <div class="courses-header">
                    <div>
                        <p class="eyebrow">Vista general del curso</p>
                        <h1>Mis cursos</h1>
                    </div>
                    <div class="courses-view">
                        <button type="button" class="pill-button active">Tarjeta</button>
                        <button type="button" class="pill-button">Lista</button>
                    </div>
                </div>

                <div class="filters">
                    <label class="filter-group">
                        <span>Categor√≠a</span>
                        <select>
                            <option>Todos</option>
                            <option>Virtual</option>
                            <option>Presencial</option>
                            <option>Licenciatura</option>
                        </select>
                    </label>
                    <label class="filter-group">
                        <span>Buscar</span>
                        <input type="search" placeholder="Nombre del curso" />
                    </label>
                    <label class="filter-group">
                        <span>Ordenar por</span>
                        <select>
                            <option>Nombre de curso</option>
                            <option>Fecha de inicio</option>
                            <option>Progreso</option>
                        </select>
                    </label>
                    <label class="filter-group">
                        <span>Vista</span>
                        <select>
                            <option>Tarjeta</option>
                            <option>Lista</option>
                        </select>
                    </label>
                </div>

                <div class="course-grid">
                    <article class="course-card" style="background: linear-gradient(135deg, #7c5bff, #5d34f3);">
                        <div class="course-body">
                            <p class="course-format">Virtual</p>
                            <p class="course-title">Competencias comunicativas (virtual) 2025-3</p>
                        </div>
                        <div class="course-footer">
                            <span class="course-progress">14% completado</span>
                            <button class="course-menu" aria-label="Opciones">‚ãÆ</button>
                        </div>
                    </article>
                    <article class="course-card" style="background: linear-gradient(135deg, #5d9ff3, #1877d2);">
                        <div class="course-body">
                            <p class="course-format">Virtual</p>
                            <p class="course-title">Desarrollo humano (virtual) 2025-3</p>
                        </div>
                        <div class="course-footer">
                            <span class="course-progress">Unidad 3</span>
                            <button class="course-menu" aria-label="Opciones">‚ãÆ</button>
                        </div>
                    </article>
                    <article class="course-card" style="background: linear-gradient(135deg, #1fa675, #0d7f57);">
                        <div class="course-body">
                            <p class="course-format">Licenciatura</p>
                            <p class="course-title">Estructura de datos (s√°b. 8:00 a 11:00)</p>
                        </div>
                        <div class="course-footer">
                            <span class="course-progress">Nuevo contenido</span>
                            <button class="course-menu" aria-label="Opciones">‚ãÆ</button>
                        </div>
                    </article>
                    <article class="course-card" style="background: linear-gradient(135deg, #7f6cf3, #8460d9);">
                        <div class="course-body">
                            <p class="course-format">Licenciatura</p>
                            <p class="course-title">Fundamentos de base de datos (sab.)</p>
                        </div>
                        <div class="course-footer">
                            <span class="course-progress">Semana 5</span>
                            <button class="course-menu" aria-label="Opciones">‚ãÆ</button>
                        </div>
                    </article>
                    <article class="course-card" style="background: linear-gradient(135deg, #2d9cca, #16658c);">
                        <div class="course-body">
                            <p class="course-format">Licenciatura</p>
                            <p class="course-title">Fundamentos de redes (sab. 4:00 pm)</p>
                        </div>
                        <div class="course-footer">
                            <span class="course-progress">Proyecto abierto</span>
                            <button class="course-menu" aria-label="Opciones">‚ãÆ</button>
                        </div>
                    </article>
                    <article class="course-card" style="background: linear-gradient(135deg, #5648c7, #40289b);">
                        <div class="course-body">
                            <p class="course-format">Licenciatura</p>
                            <p class="course-title">Integrales y aplicaciones (sab. horario)</p>
                        </div>
                        <div class="course-footer">
                            <span class="course-progress">Examen pronto</span>
                            <button class="course-menu" aria-label="Opciones">‚ãÆ</button>
                        </div>
                    </article>
                </div>

                <div class="courses-footer">
                    <span>Mostrar</span>
                    <select>
                        <option>Todos</option>
                        <option>5</option>
                        <option>10</option>
                    </select>
                </div>
            </section>

            <!-- Support View (Added) -->
            <section id="support-view" class="view-section" style="display:none; padding:80px 20px;">
                <div class="container mx-auto max-w-6xl">
                    <h2 class="text-3xl font-bold mb-6 text-white border-l-4 border-yellow-500 pl-4">Soporte LuxIA</h2>
                    <p class="text-white/60 mb-8 max-w-2xl">Consulta el estado de tus tickets y el historial de
                        atenci√≥n.</p>

                    <table class="ticket-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>T√≠tulo</th>
                                <th>Estado</th>
                                <th>Prioridad</th>
                                <th>Asignado</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody id="ticket-list-body">
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Detail Modal -->
                <div id="ticket-detail-modal" class="modal">
                    <div class="modal-content">
                        <button onclick="closeTicketModal()"
                            style="position:absolute; top:15px; right:15px; background:none; border:none; color:white; font-size:1.5em; cursor:pointer;">&times;</button>
                        <div id="ticket-detail-content"></div>
                    </div>
                </div>
            </section>


        </div>
    </main>

    <footer>
        ¬© <span id="year"></span> Lux Studio. Todos los derechos reservados.
    </footer>

    <!-- Chatbot Widget -->
    <button id="chat-trigger" class="chat-widget-btn" aria-label="Abrir chat de soporte" hidden>
        üí¨
    </button>

    <div id="chat-window" class="chat-window">
        <div class="chat-header">
            <button id="chat-back" class="chat-back" aria-label="Atr√°s">‚¨Ö</button>
            <h3 style="margin-left: 0.5rem;">Lux-IA</h3>
            <button id="chat-close" class="chat-close" style="margin-left: auto;">√ó</button>
        </div>
        <div id="chat-messages" class="chat-messages">
            <!-- Messages will appear here -->
        </div>
        <div class="chat-input-area">
            <button id="chat-attach" class="chat-attach-btn" title="Adjuntar evidencia" disabled>üìé</button>
            <input type="file" id="chat-file" accept="image/*,.pdf" hidden>
            <input type="text" id="chat-input" placeholder="Escribe un mensaje..." disabled>
            <button id="chat-send" class="chat-send" disabled>‚û§</button>
        </div>
    </div>

    <!-- Supabase Integration -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        const loginForm = document.getElementById('login-form');
        const loginAlert = document.getElementById('login-alert');
        const loginSection = document.getElementById('login');
        const studentDashboard = document.getElementById('student-dashboard');
        const navLinks = document.querySelectorAll('.nav-link');

        const VALID_USER = '017497';
        const VALID_PASSWORD = 'Unilux25';

        const STUDENT_PROFILE = {
            nombre: 'Ana Torres',
            rol: 'estudiante',
        };

        // Initialize Supabase (Safe Mode)
        let supabase = null;
        try {
            if (window.supabaseConfig && window.supabase) {
                supabase = window.supabase.createClient(window.supabaseConfig.url, window.supabaseConfig.key);
                console.log('Supabase initialized successfully');
            } else {
                console.warn('Supabase config missing or library not loaded. Running in offline mode.');
            }
        } catch (err) {
            console.error('Critical error initializing Supabase:', err);
        }

        // --- Edge Function Integration: Catalog Service ---
        async function loadCatalogs() {
            try {
                // Invocamos la Edge Function 'catalog-service'
                // Nota: Usamos fetch directo para controlar URL, ya que invoke usa POST por defecto y ruta base
                const { data: { session } } = await supabase.auth.getSession();
                const token = session?.access_token;

                // Url base de funciones (hardcoded o config)
                // Usamos la URL del proyecto si est√° en window.supabaseConfig o la construimos
                const projectRef = 'nsrduorngzyoiwpbkgku';
                const funcUrl = `https://${projectRef}.supabase.co/functions/v1/catalog-service`;

                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};

                const resp = await fetch(funcUrl, { headers });
                if (!resp.ok) throw new Error('Failed to fetch catalogs');

                const data = await resp.json();
                console.log('Catalogs loaded via Edge Function:', data);

                // Populate Maps
                if (data.categorias) {
                    CATEGORY_MAP = {}; // Reset
                    data.categorias.forEach(c => {
                        // Normalize name to key (e.g. "Sitio Web" -> "sitio_web")
                        const key = c.nombre.toLowerCase().replace(/\s+/g, '_').replace(/[^\w]/g, '');
                        CATEGORY_MAP[key] = c.catalogo_id;
                    });
                }
                if (data.prioridades) {
                    PRIORITY_MAP = {};
                    data.prioridades.forEach(p => {
                        const key = p.nombre.toLowerCase();
                        PRIORITY_MAP[key] = p.catalogo_id;
                    });
                }

                // Handle Areas
                if (data.areas && data.areas.length > 0) {
                    // Try to find 'Soporte TI' or similar
                    const soporte = data.areas.find(a => a.nombre.toLowerCase().includes('soporte'));
                    if (soporte) {
                        DEFAULT_AREA_ID = soporte.catalogo_id;
                        console.log('Area detected (Soporte):', soporte.nombre, DEFAULT_AREA_ID);
                    } else {
                        DEFAULT_AREA_ID = data.areas[0].catalogo_id; // Use first available
                        console.log('Area fallback to first available:', data.areas[0].nombre, DEFAULT_AREA_ID);
                    }
                }

            } catch (e) {
                console.warn('Catalog Service unavailable, using static fallbacks:', e);
                CATEGORY_MAP = STATIC_CATEGORY_MAP;
                PRIORITY_MAP = STATIC_PRIORITY_MAP;
            }
        }

        // Cargar cat√°logos al inicio
        loadCatalogs();


        function setActiveNav(route) {
            navLinks.forEach((link) => {
                const isActive = link.dataset.route === route;
                link.classList.toggle('active', isActive);
            });
        }

        function showStudentView() {
            if (loginSection) {
                loginSection.classList.add('hidden');
            }

            if (studentDashboard) {
                studentDashboard.removeAttribute('hidden');
                studentDashboard.scrollIntoView({ behavior: 'smooth' });
            }

            // Show chat widget
            if (chatTrigger) chatTrigger.removeAttribute('hidden');

            setActiveNav('mis-cursos');
        }

        if (loginForm) {
            loginForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                const formData = new FormData(loginForm);
                const email = formData.get('email');
                const password = formData.get('password');

                try {
                    // --- SUPABASE AUTH INTEGRATION ---
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password
                    });

                    if (error) throw error;

                    // Success
                    loginAlert.textContent = 'Acceso concedido.';
                    loginAlert.className = 'login-alert success';
                    loginAlert.hidden = false;

                    // Update User Context
                    // Assuming data.user contains valid user info
                    chatState.user = {
                        id: data.user.id,
                        email: data.user.email
                    };

                    // Proceed to Dashboard
                    showStudentView();

                    console.log('User Logged In:', data.user);

                } catch (err) {
                    console.error('Login Error:', err.message);
                    loginAlert.textContent = 'Error: ' + (err.message === 'Invalid login credentials' ? 'Credenciales incorrectas.' : err.message);
                    loginAlert.className = 'login-alert error';
                    loginAlert.hidden = false;
                }
            });
        }

        // Chatbot Logic
        const chatTrigger = document.getElementById('chat-trigger');
        const chatWindow = document.getElementById('chat-window');
        const chatClose = document.getElementById('chat-close');
        const chatBack = document.getElementById('chat-back');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');
        const chatAttach = document.getElementById('chat-attach');
        const chatFile = document.getElementById('chat-file');

        let chatState = {
            step: 'INIT',
            ticket: {},
            history: [] // To track prev steps logic if needed, but simple mapping works too
        };

        // Initialize Maps (Will be populated by Edge Function)
        let CATEGORY_MAP = {};
        // Fallback static maps in case service fails or loads slow
        const STATIC_CATEGORY_MAP = {
            'finanzas': 33, 'sitio_web': 34, 'servo_web': 35, 'materias': 36, 'bloqueos': 37
        };

        let PRIORITY_MAP = {};
        const STATIC_PRIORITY_MAP = {
            'baja': 8, 'media': 7, 'alta': 6
        };

        // Area ID Handling (Dynamic)
        let DEFAULT_AREA_ID = 38; // Fallback hardcoded if service fails

        // Fallback User ID
        const FALLBACK_USER_ID = 16;

        const STEPS_FLOW = ['GREETING', 'TITLE', 'CATEGORY', 'DETAILS', 'ATTACHMENTS', 'PRIORITY', 'NOTIFY', 'DONE'];

        function toggleChat() {
            const isOpen = chatWindow.classList.contains('open');
            if (isOpen) {
                chatWindow.classList.remove('open');
            } else {
                chatWindow.classList.add('open');
                if (chatMessages.children.length === 0) {
                    initChat();
                }
            }
        }

        chatTrigger.addEventListener('click', toggleChat);
        chatClose.addEventListener('click', toggleChat);

        chatBack.addEventListener('click', goBack);

        function goBack() {
            const currentIdx = STEPS_FLOW.indexOf(chatState.step);
            if (currentIdx > 0) {
                const prevStep = STEPS_FLOW[currentIdx - 1];
                chatState.step = prevStep;
                showStepPrompt(prevStep);
            }
        }

        function updateUIForStep(step) {
            // Show/Hide Back Button
            if (step === 'GREETING' || step === 'DONE') {
                chatBack.style.display = 'none';
            } else {
                chatBack.style.display = 'block';
            }
        }

        function addMessage(text, sender, options = []) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender}`;
            msgDiv.textContent = text;
            chatMessages.appendChild(msgDiv);

            if (options.length > 0) {
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'chat-options';
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'chat-option-btn';
                    btn.textContent = opt.label;
                    btn.onclick = () => handleInput(opt.value);
                    optionsDiv.appendChild(btn);
                });
                chatMessages.appendChild(optionsDiv);
            }

            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function initChat() {
            chatState.step = 'GREETING';
            showStepPrompt('GREETING');
        }

        function showStepPrompt(step) {
            updateUIForStep(step);

            // Clear inputs just in case
            chatInput.value = '';

            switch (step) {
                case 'GREETING':
                    enableInput(false);
                    // Reset ticket
                    chatState.ticket = {};
                    addMessage('¬°Hola! Soy Lux-IA. ¬øEn qu√© puedo ayudarte hoy?', 'bot', [
                        { label: 'Reportar un problema', value: 'report' },
                        { label: 'Consultar estado de ticket', value: 'status' }
                    ]);
                    break;
                case 'TITLE':
                    enableInput(true);
                    addMessage('Entendido. Para comenzar, por favor escribe un t√≠tulo breve para tu incidencia.', 'bot');
                    break;
                case 'CATEGORY':
                    enableInput(false);
                    addMessage('Gracias. ¬øA qu√© categor√≠a pertenece el problema?', 'bot', [
                        { label: 'Finanzas', value: 'finanzas' },
                        { label: 'Sitio Web', value: 'sitio_web' },
                        { label: 'Servo Web', value: 'servo_web' },
                        { label: 'Materias', value: 'materias' },
                        { label: 'Bloqueos/Acceso', value: 'bloqueos' }
                    ]);
                    break;
                case 'DETAILS':
                    enableInput(true);
                    addMessage('Por favor describe los detalles del problema.', 'bot');
                    break;
                case 'ATTACHMENTS':
                    enableInput(false);
                    addMessage('¬øDeseas adjuntar alguna captura de pantalla o documento?', 'bot', [
                        { label: 'S√≠, adjuntar', value: 'attach_request' },
                        { label: 'No, continuar', value: 'no_attach' }
                    ]);
                    break;
                case 'PRIORITY':
                    enableInput(false);
                    addMessage('Archivo recibido (o omitido). ¬øQu√© nivel de prioridad consideras que tiene?', 'bot', [
                        { label: 'Baja', value: 'baja' },
                        { label: 'Media', value: 'media' },
                        { label: 'Alta', value: 'alta' }
                    ]);
                    break;
                case 'NOTIFY':
                    enableInput(false);
                    addMessage('¬øDeseas notificar a alg√∫n √°rea espec√≠fica? (Opcional)', 'bot', [
                        { label: 'Servicios Escolares', value: 'escolares' },
                        { label: 'Soporte T√©cnico', value: 'soporte' },
                        { label: 'Ninguno', value: 'none' }
                    ]);
                    break;
                case 'DONE':
                    // This is handled by finishTicket mainly
                    break;
            }
        }

        function handleInput(text, isFile = false) {
            if (!text && !isFile) return;

            // Validations
            if (chatState.step === 'TITLE' && text.length < 5) {
                addMessage('El t√≠tulo es muy corto (m√≠nimo 5 letras).', 'bot');
                return;
            }
            if (chatState.step === 'DETAILS' && text.length < 15) {
                addMessage('Por favor danos m√°s detalles (m√≠nimo 15 letras).', 'bot');
                return;
            }

            // Add user message
            if (isFile) {
                addMessage(`üìé Archivo adjunto: ${text}`, 'user');
            } else {
                addMessage(text, 'user');
                chatInput.value = '';
            }

            // Process state
            setTimeout(() => {
                const nextStep = getNextStep(chatState.step, text, isFile);
                if (nextStep) {
                    chatState.step = nextStep;
                    if (nextStep === 'DONE') {
                        finishTicket();
                    } else if (nextStep === 'ATTACH_ACTION') {
                        // Interactive intermediate step for file
                        chatFile.click();
                        addMessage('Selecciona tu archivo...', 'bot');
                        // Stay in ATTACHMENTS technically but waiting for file
                        chatState.step = 'ATTACHMENTS';
                    } else if (nextStep === 'STATUS_CHECK') {
                        addMessage('Esta funcionalidad estar√° disponible pronto.', 'bot');
                        resetChat();
                    } else {
                        showStepPrompt(nextStep);
                    }
                }
            }, 500);
        }

        function getNextStep(currentStep, input, isFile) {
            switch (currentStep) {
                case 'GREETING':
                    if (input === 'report') return 'TITLE';
                    if (input === 'status') return 'STATUS_CHECK';
                    return null;
                case 'TITLE':
                    chatState.ticket.title = input;
                    return 'CATEGORY';
                case 'CATEGORY':
                    chatState.ticket.category = input;
                    return 'DETAILS';
                case 'DETAILS':
                    chatState.ticket.details = input;
                    return 'ATTACHMENTS';
                case 'ATTACHMENTS':
                    if (input === 'attach_request') return 'ATTACH_ACTION';
                    if (input === 'no_attach') return 'PRIORITY';
                    if (isFile) {
                        chatState.ticket.evidence = input;
                        return 'PRIORITY';
                    }
                    return 'PRIORITY'; // Fallback
                case 'PRIORITY':
                    chatState.ticket.priority = input;
                    return 'NOTIFY';
                case 'NOTIFY':
                    chatState.ticket.notify = input === 'none' ? null : input;
                    return 'DONE';
                default:
                    return null;
            }
        }

        function enableInput(enable) {
            chatInput.disabled = !enable;
            chatSend.disabled = !enable;
            chatAttach.disabled = !enable;
            if (enable) chatInput.focus();
        }

        async function finishTicket() {
            addMessage('Procesando tu solicitud...', 'bot');
            updateUIForStep('DONE'); // Hide back button

            try {
                if (!supabase) throw new Error('Supabase no configurado');

                // Prepare payload with correct DB columns (Spanish)
                // Note: DB uses 'categoria_id' and 'prioridad_id' in ticket table, mapping to 'catalogo' IDs.
                const catId = CATEGORY_MAP[chatState.ticket.category] || 37; // Default to 'Bloqueos' if missing
                const prioId = PRIORITY_MAP[chatState.ticket.priority] || 8; // Default to 'Baja'

                const payload = {
                    titulo: chatState.ticket.title,
                    categoria_id: catId,
                    detalles: chatState.ticket.details,
                    prioridad_id: prioId,
                    reportador_id: (chatState.user && chatState.user.id) ? undefined : FALLBACK_USER_ID, // If auth, let DB handle or pass auth_uid? Assuming DB expects integer ID from 'usuario' table, we need to map Auth UID to Usuario ID. 
                    // WAIT: 'reportador_id' is bigint/int in 'ticket', likely referencing 'usuario(usuario_id)'.
                    // Our chatState.user.id is UUID. We can't put UUID into bigint column.
                    // We must fetch the numeric ID for the logged in user or use FALLBACK.
                    // For now, let's use the fetched numeric ID if we can, or FALLBACK.
                    // But we don't have the numeric ID in chatState.user yet (only UUID).
                    // Let's stick to FALLBACK_USER_ID for reliability until we fetch numeric ID on login.
                    reportador_id: FALLBACK_USER_ID,
                    estado_id: 1, // 'Abierto'
                    area_notificada_id: DEFAULT_AREA_ID // Dynamic from Catalog Service
                };

                // Temporary log for debug
                console.log('Sending payload:', payload);

                const { data, error } = await supabase
                    .from('ticket') // Singular table name
                    .insert([payload])
                    .select();

                if (error) throw error;

                const ticketId = data[0].ticket_id; // Correct ID column name
                console.log('Ticket Created:', data[0]);

                // Enhanced Feedback
                addMessage(`‚úÖ ¬°Ticket creado con √©xito!`, 'bot');
                addMessage(`ID de seguimiento: #${ticketId}`, 'bot');
                addMessage(`Hemos notificado a soporte y recibir√°s una actualizaci√≥n pronto.`, 'bot');

            } catch (err) {
                console.error('Error creating ticket:', err);
                const localId = 'ERR-' + Math.floor(Math.random() * 1000);

                // Enhanced Error Feedback
                addMessage(`‚ùå No pudimos conectar con el servidor.`, 'bot');
                addMessage(`Detalle: ${err.message || 'Error desconocido'}`, 'bot');
                addMessage(`Tu reporte ha sido guardado localmente con referencia: ${localId}. Intenta reportarlo nuevamente m√°s tarde.`, 'bot');
            }

            addMessage('¬øNecesitas algo m√°s?', 'bot', [
                { label: 'Crear otro ticket', value: 'report' },
                { label: 'Salir', value: 'exit' }
            ]);

            // Wait for user to pick, if 'report' -> GREETING/TITLE
            setTimeout(() => {
                chatState.step = 'GREETING'; // Reset state for next interaction
            }, 1000);
        }

        function resetChat() {
            setTimeout(() => {
                initChat();
            }, 2000);
        }

        chatSend.addEventListener('click', () => handleInput(chatInput.value));
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleInput(chatInput.value);
        });

        // File attachment logic
        chatAttach.addEventListener('click', () => chatFile.click());
        chatFile.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleInput(e.target.files[0].name, true);
            }
        });

        // Initial check
        if (chatTrigger) chatTrigger.setAttribute('hidden', '');
        setActiveNav('login');

        // --- Support Dashboard Logic ---
        function showSupportView() {
            // Hide other views
            document.querySelectorAll('section').forEach(el => el.style.display = 'none');
            const supportView = document.getElementById('support-view');
            if (supportView) supportView.style.display = 'block';

            // Hide specific main views
            const studentView = document.getElementById('student-view');
            if (studentView) studentView.style.display = 'none';
            const loginSection = document.getElementById('login');
            if (loginSection) loginSection.style.display = 'none';

            loadTickets();
        }

        async function loadTickets() {
            const tbody = document.getElementById('ticket-list-body');
            tbody.innerHTML = '<tr><td colspan="6" style="text-align:center">Cargando tickets...</td></tr>';

            try {
                const { data: { session } } = await supabase.auth.getSession();
                const token = session?.access_token;
                const projectRef = 'nsrduorngzyoiwpbkgku';

                const resp = await fetch(`https://${projectRef}.supabase.co/functions/v1/ticket-manager/list`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!resp.ok) throw new Error('Error loading tickets');
                const tickets = await resp.json();

                tbody.innerHTML = '';
                if (tickets.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center">No hay tickets registrados.</td></tr>';
                    return;
                }

                tickets.forEach(t => {
                    const row = document.createElement('tr');
                    const date = new Date(t.fecha_creacion).toLocaleDateString();
                    // Optional safety check on related objects
                    const statusName = t.estado ? t.estado.nombre : 'Desconocido';
                    const statusClass = statusName === 'Abierto' ? 'status-open' : 'status-closed';
                    const prioName = t.prioridad ? t.prioridad.nombre : 'Normal';
                    const assigned = t.asignado ? `${t.asignado.nombre} ${t.asignado.apellido}` : 'Sin asignar';

                    row.innerHTML = `
                        <td>#${t.ticket_id}</td>
                        <td>${t.titulo}</td>
                        <td><span class="status-badge ${statusClass}">${statusName}</span></td>
                        <td>${prioName}</td>
                        <td>${assigned}</td>
                        <td>${date}</td>
                    `;
                    row.onclick = () => openTicketDetail(t.ticket_id);
                    tbody.appendChild(row);
                });
            } catch (e) {
                console.error(e);
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:red">Error al cargar tickets (o faltan tablas relacionadas).</td></tr>';
            }
        }

        async function openTicketDetail(id) {
            const modal = document.getElementById('ticket-detail-modal');
            const content = document.getElementById('ticket-detail-content');
            modal.classList.add('open');
            content.innerHTML = '<p style="text-align:center">Cargando detalles...</p>';

            try {
                const { data: { session } } = await supabase.auth.getSession();
                const token = session?.access_token;
                const projectRef = 'nsrduorngzyoiwpbkgku';

                const resp = await fetch(`https://${projectRef}.supabase.co/functions/v1/ticket-manager/details?id=${id}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!resp.ok) throw new Error('Error loading details');
                const { ticket, history } = await resp.json();

                const createdBy = ticket.reportador ? `${ticket.reportador.nombre} ${ticket.reportador.apellido} (${ticket.reportador.tipo_usuario})` : 'Desconocido';
                const assignedTo = ticket.asignado ? `${ticket.asignado.nombre} ${ticket.asignado.apellido}` : 'Sin Asignar';
                const eta = ticket.eta_estimada ? new Date(ticket.eta_estimada).toLocaleString() : 'Pendiente';
                const area = ticket.area ? ticket.area.nombre : 'General';
                const statusName = ticket.estado ? ticket.estado.nombre : 'Desconocido';
                const prioName = ticket.prioridad ? ticket.prioridad.nombre : 'Normal';

                let historyHtml = '';
                if (history && history.length > 0) {
                    historyHtml = history.map(h => `
                        <div class="timeline-item">
                            <div class="timeline-date">${new Date(h.fecha_cambio).toLocaleString()}</div>
                            <div class="timeline-content">
                                <strong>${h.autor?.nombre || 'Sistema'}:</strong> ${h.cambio} <br/>
                                <small>${h.valor_anterior || ''} ‚ûî ${h.valor_nuevo || ''}</small>
                            </div>
                        </div>
                    `).join('');
                } else {
                    historyHtml = '<p style="color:#888; padding-left:20px;">No hay historial de cambios.</p>';
                }

                content.innerHTML = `
                    <h2 style="color:var(--gold); border-bottom:1px solid #333; padding-bottom:10px; margin-top:0;">
                        Ticket #${ticket.ticket_id}: ${ticket.titulo}
                    </h2>
                    <div class="detail-grid">
                        <div class="detail-item"><label>Estado</label><span>${statusName}</span></div>
                        <div class="detail-item"><label>Prioridad</label><span>${prioName}</span></div>
                        <div class="detail-item"><label>√Årea</label><span>${area}</span></div>
                        <div class="detail-item"><label>Estimado (ETA)</label><span>${eta}</span></div>
                        <div class="detail-item"><label>Creado Por</label><span>${createdBy}</span></div>
                        <div class="detail-item"><label>Asignado A</label><span>${assignedTo}</span></div>
                    </div>
                    <div class="detail-item">
                        <label>Detalles del Problema</label>
                        <p style="background:rgba(255,255,255,0.05); padding:10px; border-radius:8px;">${ticket.detalles}</p>
                    </div>
                    
                    <h3 style="margin-top:30px; color:var(--gold)">Historial de Cambios</h3>
                    <div class="timeline">
                        ${historyHtml}
                    </div>
                `;
            } catch (e) {
                content.innerHTML = '<p style="color:red; text-align:center">Error al cargar detalles.</p>';
                console.error(e);
            }
        }

        function closeTicketModal() {
            document.getElementById('ticket-detail-modal').classList.remove('open');
        }

        // Hook up navigation
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                const route = link.dataset.route;
                if (route === 'soporte-luxia') {
                    showSupportView();
                }
            });
        });
    </script>
</body>

</html>